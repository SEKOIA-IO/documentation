
## Event Categories


The following table lists the data source offered by this integration.

| Data Source | Description                          |
| ----------- | ------------------------------------ |
| `Email gateway` | Cisco ESA logs many details on every handled message |
| `Mail server` | Cisco ESA logs many details on every handled message |








## Event Samples

Find below few samples of events and how they are normalized by SEKOIA.IO.


=== "test_ingest_log1.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C300V Email Security Virtual Appliance|13.0.0-392|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=4202A33F31B0BAAB537A-FBD06D401234 ESAMID=1251793 ESAICID=7186532 ESADCID=925893 ESAASVerdict=NEGATIVE ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Mon May 11 16:56:58 2020 ESADLPVerdict=NOT_EVALUATED ESADMARCVerdict=Skipped dvc=1.2.3.4 ESAAttachmentDetails={'resume.docx': {'AMP': {'Verdict': 'MALICIOUS', 'fileHash': 'b26a1d694a9cebd742cfa5d09e5f5e4697f522cc12c2e9f23638c1078bb7b0c2'}, 'BodyScanner': {}}} ESAFriendlyFrom=senderexample@example.com ESAGMVerdict=NOT_EVALUATED startTime=Mon May 11 16:56:56 2020 deviceDirection=0 ESAMailFlowPolicy=ACCEPT suser=senderexample@example.com cs1Label=MailPolicy cs1=remove_webmail_quota_spam cs2Label=SenderCountry cs2=Spain ESAMFVerdict=NO_MATCH act=DELIVERED cs4Label=ExternalMsgID cs4='<ADR4500000227856433302E0EC2F783B1EEAA4F2E836DF8C5DBD@MAILERP.EXAMPLE.COM>' ESAOFVerdict=NEGATIVE duser=example@otherexample.com ESAHeloDomain=mail.example.com ESAHeloIP=1.2.3.4 cfp1Label=SBRSScore cfp1=3.5 ESASDRDomainAge=9 years 6 months 21 days cs3Label=SDRThreatCategory cs3=N/A cs6Label=SDRRepScore cs6=Weak ESASPFVerdict=None sourceHostName=mailhost.example.es ESASenderGroup=UNKNOWNLIST sourceAddress=1.2.3.4 msg='A cool subject 123' ESATLSInCipher=ECDHE-RSA-AES256-GCM-SHA384 ESATLSInConnStatus=Success ESATLSInProtocol=TLSv1.2 ESATLSOutCipher=ECDHE-RSA-AES256-GCM-SHA384 ESATLSOutConnStatus=Success ESATLSOutProtocol=TLSv1.2",
        "event": {
            "severity": 5,
            "action": "delivered",
            "end": "2020-05-11T16:56:58.000000Z",
            "start": "2020-05-11T16:56:56.000000Z"
        },
        "@timestamp": "2020-05-11T16:56:56.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C300V Email Security Virtual Appliance",
            "version": "13.0.0-392"
        },
        "email": {
            "subject": "A cool subject 123",
            "from": {
                "address": [
                    "senderexample@example.com"
                ]
            },
            "to": {
                "address": [
                    "example@otherexample.com"
                ]
            },
            "message_id": "ADR4500000227856433302E0EC2F783B1EEAA4F2E836DF8C5DBD@MAILERP.EXAMPLE.COM",
            "local_id": "1251793",
            "attachments": [
                {
                    "file": {
                        "name": "resume.docx",
                        "hash": {
                            "sha256": "b26a1d694a9cebd742cfa5d09e5f5e4697f522cc12c2e9f23638c1078bb7b0c2"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "inbound"
        },
        "server": {
            "ip": "1.2.3.4"
        },
        "host": {
            "hostname": "mailhost.example.es",
            "name": "mailhost.example.es"
        },
        "rule": {
            "name": "remove_webmail_quota_spam"
        },
        "cisco": {
            "esa": {
                "delivery": {
                    "connection_id": "925893"
                },
                "injection": {
                    "connection_id": "7186532"
                },
                "protection": {
                    "spam": {
                        "verdict": "NEGATIVE"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "authentication": {
                    "dmarc": {
                        "verdict": "Skipped"
                    }
                },
                "sender_group": "UNKNOWNLIST"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "mailhost.example.es"
            ],
            "ip": [
                "1.2.3.4"
            ]
        }
    }
    	
	```


=== "test_ingest_log2.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C300V Email Security Virtual Appliance|13.0.0-252|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=420D4F36AAEBC0093B4F-B9E72189A021 ESAMID=4631 ESAAMPVerdict=SKIPPED ESAASVerdict=NEGATIVE ESAAVVerdict=NEGATIVE ESACFVerdict=MATCH ESADCID=66096 endTime=Tue Aug 13 15:15:48 2019 ESADKIMVerdict=pass ESADLPVerdict=NOT_EVALUATED ESADMARCVerdict=pass dvc=3.4.5.6 ESAAttachmentDetails={'presentation.pptx': {'AMP': {'Verdict': 'LOWRISK', 'fileHash': 'e4a4f9b7c4b4c7fb62b3df3c7e9e05811dc52c38eb8b76d3847f41ef299399e4'}, 'BodyScanner': {}}} ESAFriendlyFrom=no-reply@example.org ESAGMVerdict=NEGATIVE ESAICID=36050 startTime=Tue Aug 13 15:15:45 2019 deviceDirection=0 ESAMailFlowPolicy=ACCEPT suser=no-reply@example.org cs1Label=MailPolicy cs1=DEFAULT cs2Label=SenderCountry cs2=United States ESAMFVerdict=MATCH act=BOUNCED ESAFinalActionDetails=5.1.0 - Unknown address error cs4Label=ExternalMsgID cs4='<5d528dcf33830_812b56878564dc@ip-10-22-10-56.mail>' ESAOFVerdict=NEGATIVE duser=john.doe@example.org ESAHeloDomain=mail.example.orgm ESAHeloIP=10.0.0.0 cfp1Label=SBRSScore cfp1=0.9 ESASDRDomainAge=9 years 3 months 14 days cs3Label=SDRThreatCategory cs3=N/A cs6Label=SDRRepScore cs6=Neutral ESASPFVerdict=SoftFail sourceHostName=esa1.hc3033-47.iphmx.com ESASenderGroup=GREYLIST sourceAddress=1.2.3.4 msg=Cisco=20Advanced=20Phishing=20Protection=20System=20Notification=20for=20bce-demo ESATLSInCipher=ECDHE-RSA-AES128-GCM-SHA256 ESATLSInConnStatus=Success ESATLSInProtocol=TLSv1.2 ESATLSOutCipher=ECDHE-RSA-AES256-SHA384 ESATLSOutConnStatus=Success ESATLSOutProtocol=TLSv1.2 ESAURLDetails={'https://bce-demo.appc.cisco.com/sensors/a7b04388-0f6e-11e9-8def-0242ac110002': {'Category': 'Computers and Internet', 'WbrsScore': '7.3'}, 'http://mandrill.appc.cisco.com/track/open.php?u=30372747&id=d57275a6c9df40418a90fd977e3bf506': {'Category': 'Computers and Internet', 'WbrsScore': '7.3'}} deviceInboundInterface=IncomingMail",
        "event": {
            "severity": 5,
            "action": "bounced",
            "end": "2019-08-13T15:15:48.000000Z",
            "start": "2019-08-13T15:15:45.000000Z"
        },
        "@timestamp": "2019-08-13T15:15:45.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C300V Email Security Virtual Appliance",
            "version": "13.0.0-252"
        },
        "email": {
            "subject": "Cisco=20Advanced=20Phishing=20Protection=20System=20Notification=20for=20bce-demo",
            "from": {
                "address": [
                    "no-reply@example.org"
                ]
            },
            "to": {
                "address": [
                    "john.doe@example.org"
                ]
            },
            "message_id": "5d528dcf33830_812b56878564dc@ip-10-22-10-56.mail",
            "local_id": "4631",
            "attachments": [
                {
                    "file": {
                        "name": "presentation.pptx",
                        "hash": {
                            "sha256": "e4a4f9b7c4b4c7fb62b3df3c7e9e05811dc52c38eb8b76d3847f41ef299399e4"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "inbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "esa1.hc3033-47.iphmx.com",
            "name": "esa1.hc3033-47.iphmx.com"
        },
        "rule": {
            "name": "DEFAULT"
        },
        "cisco": {
            "esa": {
                "url": [
                    "https://bce-demo.appc.cisco.com/sensors/a7b04388-0f6e-11e9-8def-0242ac110002",
                    "http://mandrill.appc.cisco.com/track/open.php?u=30372747&id=d57275a6c9df40418a90fd977e3bf506"
                ],
                "delivery": {
                    "connection_id": "66096"
                },
                "injection": {
                    "connection_id": "36050"
                },
                "protection": {
                    "spam": {
                        "verdict": "NEGATIVE"
                    },
                    "antivirus": {
                        "verdict": "NEGATIVE"
                    },
                    "dlp": {
                        "verdict": "NEGATIVE"
                    }
                },
                "authentication": {
                    "dmarc": {
                        "verdict": "pass"
                    },
                    "spf": {
                        "verdict": "SoftFail"
                    },
                    "dkim": {
                        "verdict": "pass"
                    }
                },
                "sender_group": "GREYLIST"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "esa1.hc3033-47.iphmx.com"
            ],
            "ip": [
                "1.2.3.4",
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log3.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESAICID=333333 ESADCID=2222222 ESAAMPVerdict=NOT_EVALUATED ESAASVerdict=NOT_EVALUATED ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Wed Mar  1 19:02:03 2023 dvc=3.4.5.6 ESAAttachmentDetails={'resume.pdf': {'AMP': {'Verdict': 'HIGHRISK', 'fileHash': 'f41c7c5d8e3b3c2b5d5b787bc5e5f9e5e5c23d60933a24d8c36df3847c61ef1'}, 'BodyScanner': {}}} ESAFriendlyFrom=no-reply@example.org ESAGMVerdict=NOT_EVALUATED startTime=Wed Mar  1 19:02:03 2023 deviceOutboundInterface=OutgoingMail deviceDirection=1 ESAMailFlowPolicy=RELAY suser=no-reply@example.org cs1Label=MailPolicy cs1=RestrictionEmetteur cs2Label=SenderCountry cs2=not enabled ESAMFVerdict=NO_MATCH act=DELIVERED cs4Label=ExternalMsgID cs4='<11111111.2222222222222222222.JavaMail.ccccccccccc@dddddddddddddddd>' ESAMsgSize=3762 ESAOFVerdict=NOT_EVALUATED duser=john.doe@example.org ESAHeloDomain=mail.example.org ESAHeloIP=10.0.0.0 ESAReplyTo=no-reply@example.org cfp1Label=SBRSScore cfp1=not enabled sourceHostName=unknown ESASenderGroup=RELAYLIST sourceAddress=1.2.3.4 msg='\\=?UTF-8?Q?Nice to Meet you?\\='\n",
        "event": {
            "severity": 5,
            "action": "delivered",
            "end": "2023-03-01T19:02:03.000000Z",
            "start": "2023-03-01T19:02:03.000000Z"
        },
        "@timestamp": "2023-03-01T19:02:03.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "subject": "'\\=?UTF-8?Q?Nice to Meet you?\\='\n",
            "from": {
                "address": [
                    "no-reply@example.org"
                ]
            },
            "to": {
                "address": [
                    "john.doe@example.org"
                ]
            },
            "message_id": "11111111.2222222222222222222.JavaMail.ccccccccccc@dddddddddddddddd",
            "local_id": "11111111",
            "attachments": [
                {
                    "file": {
                        "name": "resume.pdf",
                        "hash": {
                            "sha256": "f41c7c5d8e3b3c2b5d5b787bc5e5f9e5e5c23d60933a24d8c36df3847c61ef1"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "outbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "unknown",
            "name": "unknown"
        },
        "rule": {
            "name": "RestrictionEmetteur"
        },
        "cisco": {
            "esa": {
                "delivery": {
                    "connection_id": "2222222"
                },
                "injection": {
                    "connection_id": "333333"
                },
                "protection": {
                    "spam": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "sender_group": "RELAYLIST"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "unknown"
            ],
            "ip": [
                "1.2.3.4",
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log4.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESAICID=333333 ESADCID=2222222 ESAAMPVerdict=NOT_EVALUATED ESAASVerdict=NOT_EVALUATED ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Wed Mar  1 19:02:03 2023 dvc=3.4.5.6 ESAAttachmentDetails={'invoice.pdf': {'AMP': {'Verdict': 'LOWRISK', 'fileHash': '01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b'}, 'BodyScanner': {}}} ESAFriendlyFrom=JOHN DOE <john.doe@example.com> ESAGMVerdict=NOT_EVALUATED startTime=Wed Mar  1 19:02:03 2023 deviceOutboundInterface=OutgoingMail deviceDirection=1 ESAMailFlowPolicy=RELAY suser=veuillez-ne-pas-repondre@example.org cs1Label=MailPolicy cs1=RestrictionEmetteur cs2Label=SenderCountry cs2=not enabled ESAMFVerdict=NO_MATCH act=DELIVERED cs4Label=ExternalMsgID cs4='<11111111111111111111111111111@ddddddd>' ESAMsgSize=111066 ESAOFVerdict=NOT_EVALUATED duser=jane.doe@example.org ESAHeloDomain=mail.example.org ESAHeloIP=10.0.0.0 cfp1Label=SBRSScore cfp1=not enabled sourceHostName=unknown ESASenderGroup=RELAYLISTTELEDEP sourceAddress=1.2.3.4 msg='\\=?utf-8?Q?For the meeting?\\='",
        "event": {
            "severity": 5,
            "action": "delivered",
            "end": "2023-03-01T19:02:03.000000Z",
            "start": "2023-03-01T19:02:03.000000Z"
        },
        "@timestamp": "2023-03-01T19:02:03.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "subject": "\\=?utf-8?Q?For the meeting?\\=",
            "from": {
                "address": [
                    "veuillez-ne-pas-repondre@example.org"
                ]
            },
            "to": {
                "address": [
                    "jane.doe@example.org"
                ]
            },
            "message_id": "11111111111111111111111111111@ddddddd",
            "local_id": "11111111",
            "attachments": [
                {
                    "file": {
                        "name": "invoice.pdf",
                        "hash": {
                            "sha256": "01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "outbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "unknown",
            "name": "unknown"
        },
        "rule": {
            "name": "RestrictionEmetteur"
        },
        "cisco": {
            "esa": {
                "delivery": {
                    "connection_id": "2222222"
                },
                "injection": {
                    "connection_id": "333333"
                },
                "protection": {
                    "spam": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "sender_group": "RELAYLISTTELEDEP"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "unknown"
            ],
            "ip": [
                "1.2.3.4",
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log5.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESAICID=333333 ESADCID=2222222 ESAAMPVerdict=LOW_RISK ESAASVerdict=NEGATIVE ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Wed Mar  1 19:02:04 2023 ESADMARCVerdict=pass dvc=3.4.5.6 ESAAttachmentDetails={'invoice.pdf': {'AMP': {'Verdict': 'LOWRISK', 'fileHash': '01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b'}, 'BodyScanner': {}}} ESAFriendlyFrom=John Doe <john.doe@example.org> ESAGMVerdict=NEGATIVE startTime=Wed Mar  1 19:02:02 2023 deviceInboundInterface=IncomingMail deviceDirection=0 ESAMailFlowPolicy=ACCEPT suser=john.doe@example.org cs1Label=MailPolicy cs1=DEFAULT cs2Label=SenderCountry cs2=Netherlands ESAMFVerdict=NO_MATCH act=DELIVERED cs4Label=ExternalMsgID cs4='<44444444444444444444444444444444444444@77777777777777777777777777.EXAMPLE.COM>' ESAMsgSize=1197675 ESAOFVerdict=NEGATIVE duser=jane.doe@example.fr ESAHeloDomain=mail.example.org ESAHeloIP=10.0.0.0 cfp1Label=SBRSScore cfp1=3.5 ESASDRDomainAge=30 days (or greater) cs3Label=SDRThreatCategory cs3=N/A cs6Label=SDRRepScore cs6=Neutral ESASPFVerdict={'mailfrom': {'result': 'Pass', 'sender': 'john.doe@example.org'}, 'helo': {'result': 'Pass', 'sender': 'postmaster@example.org'}, 'pra': {'result': 'None', 'sender': 'john.doe@example.org'}} sourceHostName=outbound.example.com ESASenderGroup=UNKNOWNLIST sourceAddress=1.2.3.4 msg='Perso' ESAURLDetails={'https://tinyurl.es/tbdra': {'WbrsScore': 9.1999999999999993, 'ExpandedUrl': 'https://facebook.com/u/john.doe'}, 'www.twitter.com': {'WbrsScore': 0.0, 'AttachmentWithUrl': 'My document.pdf'}, 'https://tiktok.com': {'WbrsScore': 4.9000000000000004}}",
        "event": {
            "severity": 5,
            "action": "delivered",
            "end": "2023-03-01T19:02:04.000000Z",
            "start": "2023-03-01T19:02:02.000000Z"
        },
        "@timestamp": "2023-03-01T19:02:02.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "subject": "Perso",
            "from": {
                "address": [
                    "john.doe@example.org"
                ]
            },
            "to": {
                "address": [
                    "jane.doe@example.fr"
                ]
            },
            "message_id": "44444444444444444444444444444444444444@77777777777777777777777777.EXAMPLE.COM",
            "local_id": "11111111",
            "attachments": [
                {
                    "file": {
                        "name": "invoice.pdf",
                        "hash": {
                            "sha256": "01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "inbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "outbound.example.com",
            "name": "outbound.example.com"
        },
        "rule": {
            "name": "DEFAULT"
        },
        "cisco": {
            "esa": {
                "url": [
                    "https://facebook.com/u/john.doe",
                    "www.twitter.com",
                    "https://tiktok.com"
                ],
                "delivery": {
                    "connection_id": "2222222"
                },
                "injection": {
                    "connection_id": "333333"
                },
                "protection": {
                    "spam": {
                        "verdict": "NEGATIVE"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "authentication": {
                    "dmarc": {
                        "verdict": "pass"
                    },
                    "spf": {
                        "verdict": "{\"helo\": {\"result\": \"Pass\", \"sender\": \"postmaster@example.org\"}, \"mailfrom\": {\"result\": \"Pass\", \"sender\": \"john.doe@example.org\"}, \"pra\": {\"result\": \"None\", \"sender\": \"john.doe@example.org\"}}"
                    }
                },
                "sender_group": "UNKNOWNLIST"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "outbound.example.com"
            ],
            "ip": [
                "1.2.3.4",
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log6.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESAICID=333333 ESADCID=2222222 ESAAMPVerdict=UNKNOWN ESAASVerdict=NEGATIVE ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Wed Mar  1 19:02:05 2023 ESADKIMVerdict=pass ESADMARCVerdict=pass dvc=3.4.5.6 ESAAttachmentDetails={'unknown': {'AMP': {'Verdict': ['FILE UNKNOWN'], 'fileHash': ['87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7']}}} ESAFriendlyFrom=John Doe <john.doe@example.org> ESAGMVerdict=NEGATIVE startTime=Wed Mar  1 19:02:02 2023 deviceInboundInterface=IncomingMail deviceDirection=0 ESAMailFlowPolicy=ACCEPT suser=john.doe@example.org cs1Label=MailPolicy cs1=DEFAULT cs2Label=SenderCountry cs2=United States ESAMFVerdict=NO_MATCH act=DELIVERED cs4Label=ExternalMsgID cs4='<111111111111111111111@mal.example.org>' ESAMsgSize=73748 ESAOFVerdict=NEGATIVE duser=jane.doe@example.org ESAHeloDomain=mail.example.org ESAHeloIP=10.0.0.0 cfp1Label=SBRSScore cfp1=3.5 ESASDRDomainAge=30 days (or greater) cs3Label=SDRThreatCategory cs3=N/A cs6Label=SDRRepScore cs6=Neutral ESASPFVerdict={'mailfrom': {'result': 'Pass', 'sender': 'john.doe@example.org'}, 'helo': {'result': 'Pass', 'sender': 'postmaster@example.org'}, 'pra': {'result': 'None', 'sender': 'no-reply@example.org'}} sourceHostName=outboun",
        "event": {
            "severity": 5,
            "action": "delivered",
            "end": "2023-03-01T19:02:05.000000Z",
            "start": "2023-03-01T19:02:02.000000Z"
        },
        "@timestamp": "2023-03-01T19:02:02.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "from": {
                "address": [
                    "john.doe@example.org"
                ]
            },
            "to": {
                "address": [
                    "jane.doe@example.org"
                ]
            },
            "message_id": "111111111111111111111@mal.example.org",
            "local_id": "11111111",
            "attachments": [
                {
                    "file": {
                        "name": "unknown",
                        "hash": {
                            "sha256": "['87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7']"
                        }
                    }
                }
            ]
        },
        "network": {
            "direction": "inbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "outboun",
            "name": "outboun"
        },
        "rule": {
            "name": "DEFAULT"
        },
        "cisco": {
            "esa": {
                "delivery": {
                    "connection_id": "2222222"
                },
                "injection": {
                    "connection_id": "333333"
                },
                "protection": {
                    "spam": {
                        "verdict": "NEGATIVE"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "authentication": {
                    "dmarc": {
                        "verdict": "pass"
                    },
                    "spf": {
                        "verdict": "{\"helo\": {\"result\": \"Pass\", \"sender\": \"postmaster@example.org\"}, \"mailfrom\": {\"result\": \"Pass\", \"sender\": \"john.doe@example.org\"}, \"pra\": {\"result\": \"None\", \"sender\": \"no-reply@example.org\"}}"
                    },
                    "dkim": {
                        "verdict": "pass"
                    }
                }
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "outboun"
            ],
            "ip": [
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log7.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESAICID=333333 ESAAMPVerdict=FA_PENDING ESAASVerdict=BULK_MAIL ESAAVVerdict=NOT_EVALUATED ESACFVerdict=MATCH endTime=Wed Mar  1 19:01:47 2023 ESADKIMVerdict=pass ESADMARCVerdict=Skipped dvc=3.4.5.6 ESAAttachmentDetails={'twitter.png': {'AMP': {'Verdict': 'FILE UNKNOWN', 'fileHash': '01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b'}, 'BodyScanner': {}}, 'appointement.ics': {'AMP': {'Verdict': 'FILE UNKNOWN', 'fileHash': '87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7'}}, 'icon-linkedin.png': {'AMP': {'Verdict': 'FILE UNKNOWN', 'fileHash': 'a3a5e715f0cc574a73c3f9bebb6bc24f32ffd5b67b387244c2c909da779a1478'}, 'BodyScanner': {}}, 'fond-gris.png': {'AMP': {'Verdict': 'FILE UNKNOWN', 'fileHash': '8d74beec1be996322ad76813bafb92d40839895d6dd7ee808b17ca201eac98be'}, 'BodyScanner': {}}, 'bg-desktop-default-header.png': {'AMP': {'Verdict': 'FILE UNKNOWN', 'fileHash': '768c71d785bf6bbbf8c4d6af6582041f2659027140a962cd0c55b11eddfd5e3d'}, 'BodyScanner': {}}} ESAFriendlyFrom=John Doe <john.doe@example.org> ESAGMVerdict=POSITIVE startTime=Wed Mar  1 19:01:45 2023 deviceInboundInterface=IncomingMail deviceDirection=0 ESAMailFlowPolicy=ACCEPT suser=john.doe@example.org cs1Label=MailPolicy cs1=DEFAULT cs2Label=SenderCountry cs2=France ESAMFVerdict=NO_MATCH act=DQ ESAFinalActionDetails=Message held temporarily in Delay Quarantine cs4Label=ExternalMsgID cs4='<111111111111111111111@mal.example.org>' ESAMsgSize=174552 ESAOFVerdict=NEGATIVE duser=jane.doe@example.org ESAHeloDomain=mail.example.org ESAHeloIP=10.0.0.0 cfp1Label=SBRSScore cfp1=5.4 ESASDRDomainAge=30 days (or greater) cs3Label=SDRThreatCategory cs3=N/A cs6Label=SDRRepScore cs6=Neutral ESASPFVerdict={'mailfrom': {'result': 'Pass', 'sender': 'john.doe@example.org'}, 'helo': {'result': 'Pass', 'sender': 'postmaster@example.org'}, 'pra': {'result': 'None', 'sender': 'no-reply@example.org'}} sourceHostName=outbound.example.com ESASenderGroup=UNKNOWNLIST sourceAddress=1.2.3.4 msg='Validation of your request' ESAURLDetails={}",
        "event": {
            "severity": 5,
            "action": "dq",
            "end": "2023-03-01T19:01:47.000000Z",
            "start": "2023-03-01T19:01:45.000000Z"
        },
        "@timestamp": "2023-03-01T19:01:45.000000Z",
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "subject": "Validation of your request",
            "from": {
                "address": [
                    "john.doe@example.org"
                ]
            },
            "to": {
                "address": [
                    "jane.doe@example.org"
                ]
            },
            "message_id": "111111111111111111111@mal.example.org",
            "local_id": "11111111",
            "attachments": [
                {
                    "file": {
                        "name": "twitter.png",
                        "hash": {
                            "sha256": "01ba4719c80b6fe911b091a7c05124b64eeece964e09c058ef8f9805daca546b"
                        }
                    }
                },
                {
                    "file": {
                        "name": "appointement.ics",
                        "hash": {
                            "sha256": "87428fc522803d31065e7bce3cf03fe475096631e5e07bbd7a0fde60c4cf25c7"
                        }
                    }
                },
                {
                    "file": {
                        "name": "icon-linkedin.png",
                        "hash": {
                            "sha256": "a3a5e715f0cc574a73c3f9bebb6bc24f32ffd5b67b387244c2c909da779a1478"
                        }
                    }
                },
                {
                    "file": {
                        "name": "fond-gris.png",
                        "hash": {
                            "sha256": "8d74beec1be996322ad76813bafb92d40839895d6dd7ee808b17ca201eac98be"
                        }
                    }
                },
                {
                    "file": {
                        "name": "bg-desktop-default-header.png",
                        "hash": {
                            "sha256": "768c71d785bf6bbbf8c4d6af6582041f2659027140a962cd0c55b11eddfd5e3d"
                        }
                    }
                }
            ]
        },
        "source": {
            "ip": "1.2.3.4",
            "address": "1.2.3.4"
        },
        "network": {
            "direction": "inbound"
        },
        "server": {
            "ip": "3.4.5.6"
        },
        "host": {
            "hostname": "outbound.example.com",
            "name": "outbound.example.com"
        },
        "rule": {
            "name": "DEFAULT"
        },
        "cisco": {
            "esa": {
                "url": [],
                "injection": {
                    "connection_id": "333333"
                },
                "protection": {
                    "spam": {
                        "verdict": "BULK_MAIL"
                    },
                    "antivirus": {
                        "verdict": "NOT_EVALUATED"
                    },
                    "dlp": {
                        "verdict": "NOT_EVALUATED"
                    }
                },
                "authentication": {
                    "dmarc": {
                        "verdict": "Skipped"
                    },
                    "spf": {
                        "verdict": "{\"helo\": {\"result\": \"Pass\", \"sender\": \"postmaster@example.org\"}, \"mailfrom\": {\"result\": \"Pass\", \"sender\": \"john.doe@example.org\"}, \"pra\": {\"result\": \"None\", \"sender\": \"no-reply@example.org\"}}"
                    },
                    "dkim": {
                        "verdict": "pass"
                    }
                },
                "sender_group": "UNKNOWNLIST"
            }
        },
        "cef": {},
        "related": {
            "hosts": [
                "outbound.example.com"
            ],
            "ip": [
                "1.2.3.4",
                "3.4.5.6"
            ]
        }
    }
    	
	```


=== "test_ingest_log8.json"

    ```json
	
    {
        "message": "CEF:0|Cisco|C390 Email Security Appliance|14.2.1-015|ESA_CONSOLIDATED_LOG_EVENT|Consolidated Log Event|5|deviceExternalId=254be28187994bc7a37f496ceac54edd ESAMID=11111111 ESADCID=2222222 ESAStatus=QUEUED",
        "event": {
            "severity": 5
        },
        "observer": {
            "vendor": "Cisco",
            "type": "C390 Email Security Appliance",
            "version": "14.2.1-015"
        },
        "email": {
            "local_id": "11111111"
        },
        "cisco": {
            "esa": {
                "delivery": {
                    "connection_id": "2222222"
                },
                "status": "QUEUED"
            }
        },
        "cef": {}
    }
    	
	```





## Extracted Fields

The following table lists the fields that are extracted, normalized under the ECS format, analyzed and indexed by the parser. It should be noted that infered fields are not listed.

| Name | Type | Description                |
| ---- | ---- | ---------------------------|
|`@timestamp` | `date` | Date/time when the event originated. |
|`cisco.esa.authentication.dkim.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's DKIM authentication mechanism. DKIM is a protocol used to verify the integrity of an email message by checking a digital signature applied by the sender's domain. |
|`cisco.esa.authentication.dmarc.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's Domain-based Message Authentication, Reporting & Conformance (DMARC) mechanism. DMARC is a protocol used to verify the authenticity of email messages by checking various authentication mechanisms, such as Sender Policy Framework (SPF) and DomainKeys Identified Mail (DKIM). |
|`cisco.esa.authentication.spf.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's SPF authentication mechanism. SPF is a protocol used to verify that an email message was sent from an authorized IP address for the sender's domain. |
|`cisco.esa.delivery.connection_id` | `keyword` |  |
|`cisco.esa.helo.domain` | `keyword` | This field indicates the domain name associated with the HELO (or EHLO) command used by the sending |
|`cisco.esa.helo.ip` | `ip` | This field indicates the IP address associated with the HELO (or EHLO) command used by the sending server during the SMTP handshake. The HELO command is used to identify the sending server to the receiving server, and the IP address can be used to help identify the geographic location of the sending server. |
|`cisco.esa.injection.connection_id` | `keyword` | This field is similar to the cisco.esa.connection_id field, but it specifically refers to the connection ID associated with an incoming message that is being injected into the ESA for processing. |
|`cisco.esa.protection.antivirus.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's antivirus protection mechanism. A verdict can be either clean (indicating that the message does not contain any known viruses or malware) or infected (indicating that the message contains one or more viruses or malware). |
|`cisco.esa.protection.dlp.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's data loss prevention (DLP) protection mechanism. DLP is a set of tools and techniques used to prevent sensitive or confidential data from being disclosed or leaked, and the verdict for a message can indicate whether it contains any such data. |
|`cisco.esa.protection.spam.verdict` | `keyword` | This field indicates the verdict assigned to a message by the ESA's spam protection mechanism. A verdict can be either spam (indicating that the message is likely unwanted or malicious) or not spam (indicating that the message is legitimate). |
|`cisco.esa.sender_group` | `keyword` | This field refers to the sender group assigned to a message by the ESA. A sender group is a way to categorize email senders based on various criteria, such as domain name, IP address, or other attributes. By assigning a sender group to a message, the ESA can apply different policies or filtering rules based on the characteristics of the sender. |
|`cisco.esa.source.domain.age` | `long` | This field indicates the age of the domain associated with the sender of a message. Older domains are generally considered more trustworthy than newer domains, so this field can be used as a factor in determining whether a message is legitimate or spam. |
|`cisco.esa.status` | `keyword` |  |
|`cisco.esa.url` | `keyword` | the declaration of the cisco urls |
|`destination.domain` | `keyword` | The domain name of the destination. |
|`destination.ip` | `ip` | IP address of the destination. |
|`destination.mac` | `keyword` | MAC address of the destination. |
|`destination.nat.ip` | `ip` | Destination NAT ip |
|`destination.nat.port` | `long` | Destination NAT Port |
|`destination.port` | `long` | Port of the destination. |
|`destination.user.id` | `keyword` | Unique identifier of the user. |
|`email.attachments` | `array` | A list of objects describing the attachment files sent along with an email message |
|`email.from.address` | `array` | A list of source email |
|`email.local_id` | `keyword` | Unique identifier given by the source. |
|`email.message_id` | `wildcard` | Value from the Message-ID header. |
|`email.subject` | `keyword` | The subject of the email message. |
|`email.to.address` | `array` | A list of destination email |
|`event.action` | `keyword` | The action captured by the event. |
|`event.end` | `date` | event.end contains the date when the event ended or when the activity was last observed. |
|`event.outcome` | `keyword` | The outcome of the event. The lowest level categorization field in the hierarchy. |
|`event.severity` | `long` | Numeric severity of the event. |
|`event.start` | `date` | event.start contains the date when the event started or when the activity was first observed. |
|`event.timezone` | `keyword` | Event time zone. |
|`file.inode` | `keyword` | Inode representing the file in the filesystem. |
|`file.mtime` | `date` | Last time the file content was modified. |
|`file.name` | `keyword` | Name of the file including the extension, without the directory. |
|`file.path` | `keyword` | Full path to the file, including the file name. |
|`file.size` | `long` | File size in bytes. |
|`file.type` | `keyword` | File type (file, dir, or symlink). |
|`host.domain` | `keyword` | Name of the directory the group is a member of. |
|`host.hostname` | `keyword` | Hostname of the host. |
|`host.id` | `keyword` | Unique host id. |
|`host.name` | `keyword` | Name of the host. |
|`host.network.egress.bytes` | `long` | The number of bytes sent on all network interfaces. |
|`host.network.ingress.bytes` | `long` | The number of bytes received on all network interfaces. |
|`http.request.method` | `keyword` | HTTP request method. |
|`http.request.referrer` | `keyword` | Referrer for this HTTP request. |
|`log.syslog.facility.name` | `keyword` | Syslog text-based facility of the event. |
|`network.protocol` | `keyword` | Application protocol name. |
|`observer.egress.interface.name` | `keyword` | Interface name |
|`observer.ingress.interface.name` | `keyword` | Interface name |
|`observer.type` | `keyword` | The type of the observer the data is coming from. |
|`observer.vendor` | `keyword` | Vendor name of the observer. |
|`observer.version` | `keyword` | Observer version. |
|`process.name` | `keyword` | Process name. |
|`rule.name` | `keyword` | Rule name |
|`server.ip` | `ip` | IP address of the server. |
|`server.nat.ip` | `ip` | Server NAT ip |
|`service.name` | `keyword` | Name of the service. |
|`source.domain` | `keyword` | The domain name of the source. |
|`source.ip` | `ip` | IP address of the source. |
|`source.mac` | `keyword` | MAC address of the source. |
|`source.nat.ip` | `ip` | Source NAT ip |
|`source.nat.port` | `long` | Source NAT port |
|`source.port` | `long` | Port of the source. |
|`url.original` | `wildcard` | Unmodified original url as seen in the event source. |
|`user_agent.original` | `keyword` | Unparsed user_agent string. |


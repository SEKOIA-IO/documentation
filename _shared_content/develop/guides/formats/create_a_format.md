# Create a new format

## Technical Requirements:

- Clone the Github repository [SEKOIA-IO/intake-formats](https://github.com/SEKOIA-IO/intake-formats)

## Create a module

If not existing, you need to create a module that will contain your format.

To create a new module, execute the following command:

```bash
> cd ~/dev/intake-formats/utils
> poetry run python3 generate.py new-module
```

Fill with the name of the module, its description and its destination directory.

A new directory, with the name of the module, will appear at the root of your workspace.

In the `_meta` directory, add a logo to illustrate your module with the following criteria:

- The logo must be a PNG image
- The logo must be named `logo.png`
- The background must be transparent
- The image must be squared, ie the width is equal to the height
- The weight of the logo must be lesser than 50kb.

## Create a format

To create a new format, execute the following command:

```bash
> cd ~/dev/intake-formats/utils
> poetry run python3 generate.py new-format <module_directory>
```

Fill with the name of the format, its slug and its description.

Your new format will appear, as a directory, under its module directory.

Open your format’s manifest (`_meta/manifest.yml`) and provides some [data sources](datasources.md) with a description for each one.

In the `_meta` directory, add a logo to illustrate your format with the following criteria:

- The logo must be a PNG image
- The logo must be named `logo.png`
- The background must be transparent
- The image must be squared, ie the width is equal to the height
- The weight of the logo must be lesser than 50kb.

## Create the parser

In the format directory, go to the `ingest` folder and edit `parser.yml`

Follow [this guide](parser.md) to develop our parser.

The parser must generate [structured events](structured_event.md) that respect the [taxonomy of the format](taxonomy.md).

## Create test

From a sample event, use [create_test.py](https://github.com/SEKOIA-IO/intake-formats/blob/main/utils/create_test.py) to create a new test file..

```bash
> cd ~/dev/intake-formats/utils
> poetry run python3 create_test.py ~/dev/intake-formats/<module>/<format>/tests/test_my_event.json <event>
> cat /tmp/raw_event.txt | poetry run python3 create_test.py ~/dev/intake-formats/<module>/<format>/tests/test_my_second_event.json -
```

Complete the test file with expected fields.

## Run tests

Tests are run from the `intake-formats/utils` directory. 

```bash
> cd ~/dev/intake-formats/utils
> poetry run pytest test_formats.py -vv               # run tests for all parsers
> poetry run pytest test_formats.py -vv --changes     # run tests only for updated parsers
> poetry run pytest test_formats.py --module='module-name' -vv # run tests for a specific module
> poetry run pytest test_formats.py --format='format-name' -vv # run tests for a specific format
> poetry run pytest test_formats.py --format='format-name' --fix-expectations # fix test expectations
```

## Write smart-descriptions

The [structured events](structured_event.md), generated by the parser, can be hardly readable for a human. The smart descriptions will define how to describe the events and which important information must be displayed in the description to ease the decision-making process.

In the format directory, go to the `_meta` folder and edit `smart-descriptions.json`

Follow [this guide](smartdescriptions.md) to write smart-descriptions for your format.
